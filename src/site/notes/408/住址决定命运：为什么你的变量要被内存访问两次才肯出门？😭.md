---
{"dg-publish":true,"dg-permalink":"/408/住址决定命运：为什么你的变量要被内存访问两次才肯出门？😭","permalink":"/408/住址决定命运：为什么你的变量要被内存访问两次才肯出门？😭/","dgShowBacklinks":true,"dgShowLocalGraph":true,"dgShowInlineTitle":true}
---

### 核心问题解答：为何地址会影响存取周期？

主存地址之所以影响存取周期数，是因为现代CPU与内存之间的数据交换并非一个字节一个字节地进行，而是一次取一个固定大小的“数据块”；如果一个变量的存放位置刚好跨越了两个“数据块”的边界，那么即使这个变量本身很小，也必须分两次访问才能把它完整地取出来。

这个现象，在计算机体系结构中被称为**数据对齐（Data Alignment）**问题。

---

### 分析


#### 第一步：分析硬件配置

- **存储器总线宽度是64位**：这意味着CPU与主存之间的数据通路是64位宽，即8个字节（8B）。可以把这条通路想象成一条8车道并排的高速公路，**一次数据传输（一个总线周期），最多可以运送8个字节的数据**。
    
- **内存条由8个16M x 8位的DRAM芯片构成16M x 64位的内存**：这是典型的**位扩展**设计。8个8位的芯片并联工作，每个芯片贡献8位，共同组成一个64位的数据字。当CPU访问内存时，这8个芯片会被同时选中，同时工作，一次性提供64位的数据。
    
- **支持突发传送方式（Burst Mode）**：这是一种高效的数据传输模式。当CPU需要读取一块连续数据时（比如一个缓存行），它只需给出首地址，内存系统就能自动地、连续地传输后续的数据块，而无需CPU为每个数据块都发出一次读命令。
    

从以上配置我们可以得出一个至关重要的结论：这个内存系统的**存取粒度**或**访问基本单位**是**64位（8字节）**。它在设计上就是为了高效地进行8字节对齐的访问。内存地址可以被看作是一系列连续的、8字节大小的“格子”。

#### 第二步：剖析变量x和y的“住址”问题

1. **分析变量x (double)**
    
    - **大小**：`double`类型通常占用**8个字节**。
        
    - **地址**：`2026 0000H`。
        
    - **对齐分析**：这个地址的最后一位是`0`，可以被8整除。这意味着变量x的起始地址**恰好是一个8字节数据块的起始地址**。它完整地、不多不少地占据了从`2026 0000H`到`2026 0007H`这一个8字节的“格子”。
        
    - **存取过程**：CPU只需要发起一次对`2026 0000H`地址的读操作，内存系统就能在一个存取周期内，通过64位总线将这完整的8个字节一次性传送给CPU。
        
    - **结论**：因此，**读取变量x只需要一个存取周期**。
        
2. **分析变量y (int)**
    
    - **大小**：`int`类型通常占用**4个字节**。
        
    - **地址**：`2026 1006H`。
        
    - **对齐分析**：这个地址不能被8整除，甚至不能被4整除。让我们看看它在8字节的“格子”里是怎么存放的：
        
        - 我们知道内存的“格子”是从`...0H`和`...8H`开始的。地址`2026 1006H`属于从`2026 1000H`到`2026 1007H`这个格子。
            
        - 变量y占用的4个字节地址是：`2026 1006H`, `2026 1007H`, `2026 1008H`, `2026 1009H`。
            
        - **问题出现了！** 它的前2个字节（`...1006H`, `...1007H`）位于`2026 1000H`开始的内存块中，而后2个字节（`...1008H`, `...1009H`）则位于下一个内存块（从`2026 1008H`开始）中。
            
        - 这种情况，我们称之为**“跨界存储”**或**“非对齐访问”**。
            
    - **存取过程**：由于变量y的数据被分割在了两个不同的8字节对齐块中，CPU无法通过一次读操作就获取完整的数据。它必须：
        
        1. **第一次存取**：发起对`2026 1000H`地址所在块的读取，得到y的前半部分。
            
        2. **第二次存取**：发起对`2026 1008H`地址所在块的读取，得到y的后半部分。
            
    - **结论**：因此，**“读取变量y需要两个存取周期”是正确的**。
        

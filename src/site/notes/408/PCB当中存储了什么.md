---
{"dg-publish":true,"dg-permalink":"/408/PCB当中存储了什么","permalink":"/408/PCB当中存储了什么/","dgShowBacklinks":true,"dgShowLocalGraph":true,"dgShowInlineTitle":true}
---

## PCB 中都存放了什么？（详细讲解）
**进程控制块（Process Control Block, PCB）** 是操作系统为每个进程维护的一个数据结构，它包含了操作系统管理和调度该进程所需的所有信息。PCB 是进程存在的唯一标志，进程的绝大部分信息都存放在 PCB 中。

PCB 中主要包含以下几类信息：

### 1. 进程标识符（Process Identification Information）
用于唯一地标识一个进程。

- **进程 ID（PID）**：系统分配给每个进程的唯一数字标识符。
    
- **父进程 ID（PPID）**：创建当前进程的父进程的 ID。
    
- **用户 ID（UID）**：拥有该进程的用户 ID。
    
- **组 ID（GID）**：拥有该进程的用户所属的组 ID。
    
- **子进程列表**：指向其所有子进程 PCB 的指针或 ID 列表（可选，有时也通过其他方式维护）。


### 2. 进程状态信息（Process State Information）
记录进程当前的运行状态，用于调度和状态转换。

- **进程状态**：如就绪（Ready）、运行（Running）、阻塞（Blocked/Waiting）、新建（New）、终止（Terminated）等。这是最基本的进程状态。


### 3. CPU 现场信息（CPU State Information / Context Information）
这部分信息是进程进行上下文切换时必须保存和恢复的，以确保进程能够从上次中断的地方继续执行。

- **程序计数器（Program Counter, PC）**：指向下一条要执行指令的地址。
    
- **寄存器集合**：
    
    - **通用寄存器**：如 AX, BX, CX, DX 等（x86 架构），用于存放数据和地址。
        
    - **状态寄存器（PSW/FLAGS）**：存放条件码、模式位等，反映CPU当前状态。
        
    - **栈指针（Stack Pointer, SP）**：指向当前进程的用户栈顶。
        
    - **段寄存器**：如 CS, DS, SS, ES（在分段内存管理中），存放段的基址。
        
    - **内存管理相关寄存器**：这非常关键。
        
        - **页表基址寄存器（Page Table Base Register, PTBR）**：存放该进程**页表的物理起始地址**。在 x86 架构中通常是 **CR3 寄存器**。当进程调度时，操作系统会将该值加载到 CPU 相应的寄存器中，使 MMU 能够正确进行地址转换。
            
        - **段表基址寄存器**：在分段管理中，存放段表的物理起始地址。
            
        - **（可选）限定寄存器/界限寄存器**：用于分段管理或基址寄存器/界限寄存器组合方式的内存保护。
            
- **其他控制信息**：如中断屏蔽字（Interrupt Mask Word）等。


### 4. 进程调度信息（Process Scheduling Information）
调度程序根据这些信息来选择下一个要执行的进程。

- **进程优先级**：用于决定调度顺序。
    
- **调度参数**：如时间片大小、已运行时间、等待时间等。
    
- **事件信息**：如果进程处于阻塞状态，需要记录它正在等待什么事件发生（例如，等待 I/O 完成、等待信号量）。
    
- **队列指针**：指向调度队列（如就绪队列、各种等待队列）中的下一个 PCB，将 PCB 连接成链表。


### 5. 内存管理信息（Memory Management Information）
描述进程的地址空间情况。

- **页表或段表指针**：指向该进程的页表或段表的地址。这是虚拟地址到物理地址映射的关键。
    
- **内存分配情况**：已分配的内存块大小和起始地址（对于采用段式管理或混合管理的文件系统）。
    
- **边界寄存器信息**：定义进程代码、数据、栈等段的起始地址和大小。


### 6. 文件管理信息（File Management Information / I/O Status Information）
记录进程打开的文件和 I/O 设备的使用情况。

- **已打开文件列表（或文件描述符表）**：一个数组或链表，记录了该进程当前所有打开文件的信息。每个条目通常是一个**指向系统级打开文件表中相应条目的指针或索引**。
    
- **I/O 状态信息**：记录进程未完成的 I/O 操作、已分配的 I/O 设备等。


### 7. 记账信息（Accounting Information）
用于统计进程资源使用情况。

- **CPU 使用时间**：进程已占用 CPU 的总时间。
    
- **时间限制**：进程允许运行的最长时间。
    
- **各种资源使用量**：如打印页数、磁盘用量等。
    

---



## 示例图示（PCB 逻辑结构）
```
+------------------------------------+
|          进程控制块 (PCB)          |
+------------------------------------+
|                                    |
| 1. 进程标识符信息                  |
|    - 进程ID (PID)                  |
|    - 父进程ID (PPID)               |
|    - 用户ID (UID)                  |
|    - 组ID (GID)                    |
|    - ...                           |
|                                    |
| 2. 进程状态信息                    |
|    - 进程状态 (就绪/运行/阻塞等)   |
|                                    |
| 3. CPU 现场信息 (CPU Context)      |
|    - 程序计数器 (PC)               |
|    - 各种通用寄存器 (AX, BX, ...)  |
|    - 状态寄存器 (PSW/FLAGS)        |
|    - 栈指针 (SP)                   |
|    - **页表基址寄存器 (PTBR/CR3)** |
|    - (分段管理中的段寄存器等)      |
|    - ...                           |
|                                    |
| 4. 进程调度信息                    |
|    - 进程优先级                    |
|    - 调度参数 (时间片、已运行时间) |
|    - 事件信息 (等待的事件)         |
|    - 队列指针 (指向下一PCB)        |
|                                    |
| 5. 内存管理信息                    |
|    - **页表/段表指针 (基地址)** |
|    - 内存段的界限/大小             |
|    - ...                           |
|                                    |
| 6. 文件管理/I/O 状态信息           |
|    - 已打开文件列表 (FD 表)        |
|    - I/O 设备分配情况              |
|    - ...                           |
|                                    |
| 7. 记账信息                        |
|    - CPU 使用时间                  |
|    - 各种资源使用量                |
|    - ...                           |
|                                    |
+------------------------------------+
```

---


1. **核心概念**：PCB 是进程的唯一标志，理解其重要性。
    
2. **内容分类**：常考 PCB 中包含哪些类型的信息，例如“下列哪项信息不属于 PCB 内容？”或“PCB 中最能体现进程动态性的是？”（答案通常是进程状态或 CPU 现场信息）。
    
3. **进程切换（上下文切换）**：当进程切换时，需要保存和恢复哪些信息？这是必考点。答案就是 PCB 中的 **CPU 现场信息**（特别是 PC、寄存器和页表基址等）。
    
4. **PCB 的位置**：通常位于内核空间，受到操作系统的保护，用户进程无法直接访问。
    
5. **与进程、程序的关系**：
    
    - **程序**：是静态的指令集合，可以理解为代码本身。
        
    - **进程**：是程序的一次执行过程，是动态的，具有生命周期。PCB 是进程的实体。
        
    - 一个程序可以对应多个进程（多次运行）。
        
    - 一个进程只对应一个 PCB。

